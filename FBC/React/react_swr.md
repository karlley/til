# React SWR

## 公式ドキュメント

https://swr.vercel.app/ja/docs/getting-started

### はじめに

- SWRとは
  - データ取得のための React Hooks ライブラリ
  - HTTPキャッシュ無効化戦略
  - state-while-revalidate
  - キャッシュからデータを返却(stale) -> フェッチリクエスト(revalidate) -> 最新データ取得

### API

- ポーリング
  - polling
  - 一定の間隔でサーバーにリクエストを送り、新しいデータがあるか確認すること

### グローバルな設定

- `<SWRConfig>` で全てのSWRのグローバル設定が可能
- 設定はネストできる(子は親の設定を引き継ぐ)
- 設定値にはオブジェクト、関数を渡せる

### データの取得

- fetcherは非同期関数
- ポリフィル: 最新のWeb APIやJavaScriptの機能を古い環境でも使えるようにすること
- データの取得には任意のライブラリを使用できる

### エラーハンドリング

- fetcherでエラーが投げられるとerrorオブジェクトを返す
- 取得時のdata、errorは同時に存在する
- Exponential backoffアルゴリズム
  - エラー発生時のリトライ間隔を徐々に長くしていくこと
  - 再試行回数が増えるにつれて再試行までの間隔が広くなっていく
  - 過度な再試行の抑止になる
- エラーを元に外部ライブラリでUIに通知することが可能

### 自動再検証

- ページフォーカス時、タブ切り替え時に自動的にデータを再検証する
- フックに関連付けられてるコンポーネントが画面に表示されていると再フェッチする
- 自動フェッチの無効化は`useSWRImmutable` を使用する

### 条件付きフェッチ

- 特定の条件下でフェッチしたい場合はkeyに`null` かfalsyな値を返す関数を渡す
- シリアルフェッチ: あるデータの取得後に取得したデータを元に次のデータを取得すること

### 引数

- keyはfetcherの引数として渡される
- fetcherに複数の引数を渡す場合は配列にして渡す

### ミューテーションと再検証

- ミューテート: キャッシュされているデータを直接変更すること
- mutateを使うことで手動で任意のタイミングでデータの再フェッチを行う
- レースコンディション: 複数の非同期関数が実行され、完了順によって予期しない動作が発生する問題

### ページネーション

- `useSWRInfinite` 
  - ページネーション、無限スクロールに対応したデータ取得を行う
  - データ取得を連続して行うイメージ

### サブスクリプション

- `useSWRSubscription`: リアルタイムでデータの更新を受取り反映する

### プリフェッチ

- プリフェッチ
  - リクエスト前に事前にデータを取得しておくこと
  - 高速レスポンスが可能になる
- プリフェッチで取得したデータをSWRにキャッシュさせることが可能

## リポジトリ準備

```sh
git clone git@github.com:karlley/fbc-swr-practice.git
cd fbc-swr-practice
npm install
npm start
```

## swrインストール

```sh
npm i swr
```
